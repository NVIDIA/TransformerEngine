<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -15 900 445" width="100%" style="max-width: 900px;">
  <style>
    .scale-fill { fill: #FFA500; stroke: #444; stroke-width: 2; }
    .scale-fill-nostroke { fill: #FFA500; stroke: none; }
    .grid-line { stroke: #444; stroke-width: 2; fill: none; }
    .dots-text { font: bold 24px sans-serif; fill: #333; text-anchor: middle; }
    .label { font: 12px sans-serif; fill: #333; text-anchor: middle; }
    .num-text { font: bold 12px sans-serif; fill: #333; text-anchor: middle; dominant-baseline: middle; }
    .arrow-line { stroke: #444; stroke-width: 2; fill: none; }
    .outer-border { fill: none; stroke: #444; stroke-width: 1.5; }
    .inner-line { stroke: #444; stroke-width: 1; stroke-dasharray: 3,2; }
    .num-text-small { font: bold 11px sans-serif; fill: #333; text-anchor: middle; dominant-baseline: middle; }
    .dots-text-small { font: bold 14px sans-serif; fill: #333; text-anchor: middle; dominant-baseline: middle; }
  </style>
  
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto">
      <polygon points="0 0, 10 5, 0 10" fill="#444" />
    </marker>
  </defs>
  
  <!-- ======== PART 1: Linearization (from mxfp8_scale_linearize.svg) ======== -->
  <g id="linearization">
    <!-- Left: Scaling factors grid -->
    <!-- Main rectangle with white background -->
    <rect x="40" y="40" width="120" height="240" fill="#FFFFFF" stroke="#444" stroke-width="2"/>
    
    <!-- Orange grid area (upper-left) -->
    <rect x="40" y="40" width="60" height="180" fill="#FFA500" stroke="#444" stroke-width="2"/>
    
    <!-- Grid lines for narrow blocks (3 columns x 3 rows) -->
    <line x1="60" y1="40" x2="60" y2="220" class="grid-line"/>
    <line x1="80" y1="40" x2="80" y2="220" class="grid-line"/>
    <line x1="40" y1="100" x2="100" y2="100" class="grid-line"/>
    <line x1="40" y1="160" x2="100" y2="160" class="grid-line"/>
    
    <!-- Numbers in orange cells -->
    <!-- Row 1 -->
    <text x="50" y="70" class="num-text">1</text>
    <text x="70" y="70" class="num-text">2</text>
    <text x="90" y="70" class="num-text">3</text>
    <!-- Row 2 -->
    <text x="50" y="125" class="num-text">K</text>
    <text x="50" y="137" class="num-text">+</text>
    <text x="50" y="149" class="num-text">1</text>
    <text x="70" y="125" class="num-text">K</text>
    <text x="70" y="137" class="num-text">+</text>
    <text x="70" y="149" class="num-text">2</text>
    <text x="90" y="125" class="num-text">K</text>
    <text x="90" y="137" class="num-text">+</text>
    <text x="90" y="149" class="num-text">3</text>
    <!-- Row 3 -->
    <text x="50" y="180" class="num-text">2K</text>
    <text x="50" y="192" class="num-text">+</text>
    <text x="50" y="204" class="num-text">1</text>
    <text x="70" y="180" class="num-text">2K</text>
    <text x="70" y="192" class="num-text">+</text>
    <text x="70" y="204" class="num-text">1</text>
    <text x="90" y="180" class="num-text">2K</text>
    <text x="90" y="192" class="num-text">+</text>
    <text x="90" y="204" class="num-text">3</text>
    
    <!-- Dots in white area (right side) -->
    <text x="125" y="90" class="dots-text">…</text>
    <text x="125" y="150" class="dots-text">…</text>
    <text x="125" y="210" class="dots-text">…</text>
    
    <!-- Dots in white area (bottom) -->
    <text x="60" y="260" class="dots-text">⋮</text>
    <text x="90" y="260" class="dots-text">⋮</text>
    <text x="125" y="260" class="dots-text">⋱</text>
    
    <!-- Arrow pointing to first block with label 128x4 -->
    <text x="50" y="0" class="label" text-anchor="middle">128x4</text>
    <path d="M 50 5 L 50 38" class="arrow-line" marker-end="url(#arrowhead)"/>
    
    <!-- Arrow -->
    <path d="M 200 150 L 300 150" class="arrow-line" marker-end="url(#arrowhead)"/>
    
    <!-- Right: Linearized 1D array -->
    <!-- Main rectangle with white background -->
    <rect x="340" y="140" width="520" height="20" fill="#FFFFFF" stroke="#444" stroke-width="2"/>
    
    <!-- Orange cells -->
    <rect x="340" y="140" width="70" height="20" fill="#FFA500" stroke="#444" stroke-width="2"/>
    <text x="375" y="150" class="num-text">1</text>
    
    <rect x="410" y="140" width="70" height="20" fill="#FFA500" stroke="#444" stroke-width="2"/>
    <text x="445" y="150" class="num-text">2</text>
    
    <rect x="480" y="140" width="70" height="20" fill="#FFA500" stroke="#444" stroke-width="2"/>
    <text x="515" y="150" class="dots-text">…</text>
    
    <rect x="550" y="140" width="70" height="20" fill="#FFA500" stroke="#444" stroke-width="2"/>
    <text x="585" y="150" class="num-text">K + 1</text>
    
    <rect x="620" y="140" width="70" height="20" fill="#FFA500" stroke="#444" stroke-width="2"/>
    <text x="655" y="150" class="num-text">K + 2</text>
    
    <!-- White area with dots -->
    <text x="725" y="150" class="dots-text">…</text>
    
    <!-- Arrow pointing to first linearized block with label 1x512 -->
    <text x="375" y="75" class="label" text-anchor="middle">1x512</text>
    <path d="M 375 80 L 375 138" class="arrow-line" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- ======== Connection: Arrow from "1" to bottom left block with brace ======== -->
  <g id="connection">
    <!-- Label above brace -->
    <text x="250" y="335" class="label">128 4-bit elements</text>
    
    <!-- Curly brace on top of the bottom left block -->
    <path d="M 115 355 
             Q 115 345, 125 345
             L 245 345
             Q 250 345, 250 340
             Q 250 345, 255 345
             L 375 345
             Q 385 345, 385 355" 
          fill="none" stroke="#444" stroke-width="2"/>
    
    <!-- Arrow from "1" cell down to the center of the brace -->
    <path d="M 375 175 Q 375 260, 250 315" class="arrow-line" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- ======== PART 2: Swizzling (from mxfp8_swizzle_indices.svg) ======== -->
  <!-- Offset by 330 (300 + 30px gap) -->
  <g id="swizzling" transform="translate(100, 330)">
    <!-- Left: Sequential indices -->
    <g id="sequential">
      <!-- Background -->
      <rect x="15" y="35" width="270" height="30" class="scale-fill-nostroke"/>
      <rect x="15" y="35" width="270" height="30" class="outer-border"/>
      
      <!-- Dashed internal lines -->
      <line x1="45" y1="35" x2="45" y2="65" class="inner-line"/>
      <line x1="75" y1="35" x2="75" y2="65" class="inner-line"/>
      <line x1="105" y1="35" x2="105" y2="65" class="inner-line"/>
      <line x1="135" y1="35" x2="135" y2="65" class="inner-line"/>
      <line x1="165" y1="35" x2="165" y2="65" class="inner-line"/>
      <line x1="195" y1="35" x2="195" y2="65" class="inner-line"/>
      <line x1="225" y1="35" x2="225" y2="65" class="inner-line"/>
      <line x1="255" y1="35" x2="255" y2="65" class="inner-line"/>
      
      <!-- Numbers -->
      <text x="30" y="50" class="num-text-small">0</text>
      <text x="60" y="50" class="num-text-small">1</text>
      <text x="90" y="50" class="num-text-small">2</text>
      <text x="120" y="50" class="num-text-small">3</text>
      <text x="150" y="50" class="num-text-small">4</text>
      <text x="180" y="50" class="num-text-small">5</text>
      <text x="210" y="50" class="num-text-small">6</text>
      <text x="240" y="50" class="num-text-small">7</text>
      <text x="270" y="50" class="dots-text-small">...</text>
    </g>
    
    <!-- Arrow -->
    <path d="M 300 50 L 340 50" class="arrow-line" marker-end="url(#arrowhead)"/>
    
    <!-- Right: Swizzled indices -->
    <g id="swizzled">
      <!-- Background -->
      <rect x="360" y="35" width="270" height="30" class="scale-fill-nostroke"/>
      <rect x="360" y="35" width="270" height="30" class="outer-border"/>
      
      <!-- Dashed internal lines -->
      <line x1="390" y1="35" x2="390" y2="65" class="inner-line"/>
      <line x1="420" y1="35" x2="420" y2="65" class="inner-line"/>
      <line x1="450" y1="35" x2="450" y2="65" class="inner-line"/>
      <line x1="480" y1="35" x2="480" y2="65" class="inner-line"/>
      <line x1="510" y1="35" x2="510" y2="65" class="inner-line"/>
      <line x1="540" y1="35" x2="540" y2="65" class="inner-line"/>
      <line x1="570" y1="35" x2="570" y2="65" class="inner-line"/>
      <line x1="600" y1="35" x2="600" y2="65" class="inner-line"/>
      
      <!-- Numbers -->
      <text x="375" y="50" class="num-text-small">0</text>
      <text x="405" y="50" class="num-text-small">32</text>
      <text x="435" y="50" class="num-text-small">64</text>
      <text x="465" y="50" class="num-text-small">96</text>
      <text x="495" y="50" class="num-text-small">1</text>
      <text x="525" y="50" class="num-text-small">33</text>
      <text x="555" y="50" class="num-text-small">65</text>
      <text x="585" y="50" class="num-text-small">97</text>
      <text x="615" y="50" class="dots-text-small">...</text>
    </g>
  </g>
</svg>

